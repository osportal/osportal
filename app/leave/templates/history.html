{% extends "calendar_base.html" %}
{%- import "macros/pagination.html" as items -%}
{% import 'macros/form.html' as f with context %}

{% block title %}Leave History{% endblock title %}

{% set delete_endpoint = 'leave.delete' %}

{% block calendar_content %}
<input type="hidden" id="q" name="q" value="{{ request.args.get('q') }}">
<div class="table-wrapper">
    <table class="table">
        <thead class="thead">
            <tr>
                <th scope="col">
                    {{ items.sort('ltype', 'Type') }}
                </th>
                <th scope="col">
                    {{ items.sort('start_date', 'Start Date') }}
                </th>
                <th scope="col">
                    {{ items.sort('end_date', 'End Date') }}
                </th>
                <th scope="col">
                    {{ items.sort('days', 'Duration') }}
                </th>
                <th scope="col">
                    {{ items.sort('status', 'Status') }}
                </th>
                <th scope="col">
                </th>
            </tr>
        </thead>
        <tbody>
        {% for leave in leaves.items %}
        <tr>
            <td>
                {{ leave.ltype }}
            </td>
            <td>
                {{ leave.start_date.strftime("%-d %b %Y") }}
            </td>
            <td>
                {{ leave.end_date.strftime("%-d %b %Y") }}
            </td>
            <td>
                {{ leave.num_days }} days
            </td>
            <td>
                {{ leave.status }}
            </td>
            <td>
                {% if leave.status == 'Pending' %}
                <div class="btn-toolbar" style="flex-wrap: unset !important;">
                    <a class="btn btn-sm btn-primary m-1" href="{{ url_for('leave.edit', id=leave.id) }}">Edit</a>
                    <a class="btn btn-sm btn-danger m-1" href="#" data-target="#deleteLeaveModal-{{leave.id}}" data-toggle="modal">Delete</a>
                </div>
                {% endif %}
            </td>
        </tr>
        <!-- Delete Pending Leave Modal -->
        <div class="modal fade" id="deleteLeaveModal-{{leave.id}}" tabindex="-1" role="dialog" aria-labelledby="deleteLeaveModalLabel" aria-hidden="true">
        	<div class="modal-dialog">
        		<div class="modal-content">
        				<div class="modal-header">
                            <h5 class="modal-title" id="deleteLeaveModalLabel">Delete {{ leave.status }} Leave Request</h5>
        					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
        					    <span aria-hidden="true">&times;</span>
        					</button>
        				</div>
                        <div class="modal-body">
                            <p>
                            Are you sure you want to delete the {{ leave.status }} leave request?
                            <div>Type: {{ leave.ltype }}</div>
                            <div>Dates: {{ leave.start_date.strftime("%-d %b %Y") }} - {{ leave.end_date.strftime("%-d %b %Y") }}</div>
                            <div>Days: {{ leave.num_days }}</div>
                            </p>
                            {% set kwargs = {'id': leave.id } %}
                            {% call f.form_tag(delete_endpoint, form=form, **kwargs) %}
                            <button type="submit" class="btn btn-primary btn-block">
                                Delete
                            </button>
                            {% endcall %}
                        </div>
        	    </div>
            </div>
        </div>
        {% endfor %}
        </tbody>
    </table>
</div><!-- End of table wrapper -->
{{ items.paginate(leaves) }}
{% endblock calendar_content %}
